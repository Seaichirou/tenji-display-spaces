<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å±•ç¤ºãƒ“ãƒ¥ãƒ¼ã‚¢</title>
<link rel="stylesheet" href="style.css">
<body>

<header>
  <div class="header-inner">
    <h1 id="title">å±•ç¤ºãƒ“ãƒ¥ãƒ¼ã‚¢</h1>
    <div class="controls" style="margin-left:auto;">
      <a class="btn" href="index.html">å±•ç¤ºä¸€è¦§ã¸æˆ»ã‚‹</a>
      <a class="btn warm" href="https://tenji-convert-machine-8fbe49b32604.herokuapp.com/" target="_blank" rel="noopener">å¤‰æ›ã‚µã‚¤ãƒˆã¸æˆ»ã‚‹</a>
    </div>
  </div>
</header>

<main>
  <div class="card">
    <div id="meta" class="viewer-meta"></div>
    <div class="controls" style="margin:8px 0 12px 0;">
      <div class="range">
        <label for="size">æ–‡å­—ã‚µã‚¤ã‚º</label>
        <input id="size" type="range" min="18" max="30" value="22">
      </div>
      <!-- ğŸ‘‡ ä¸è¦ã¨è¨€ã‚ã‚ŒãŸ2ã¤ã®ãƒœã‚¿ãƒ³ã¯å‰Šé™¤ã—ã¾ã—ãŸ -->
    </div>
    <div class="viewer">
      <pre id="content">èª­ã¿è¾¼ã¿ä¸­â€¦</pre>
    </div>
  </div>
</main>

<footer class="footer">Â© tenji-display-spaces / CC BY-NC 4.0</footer>

<script>
const qs = new URLSearchParams(location.search);
const id = qs.get('id');
const type = qs.get('type'); // "å¢¨å­—" / "6ç‚¹å¼ç‚¹å­—" / "8ç‚¹å¼ç‚¹å­—" / "å‚™è€ƒ"

async function load() {
  // manifest èª­ã¿è¾¼ã¿ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ï¼‰
  const res = await fetch('manifest.json?v=' + Date.now(), { cache: 'no-cache' });
  const data = await res.json();

  const ex = data.exhibits.find(e => e.id === id);
  const title = document.getElementById('title');
  const meta  = document.getElementById('meta');
  const pre   = document.getElementById('content');

  if (!ex) { pre.textContent = 'ä½œå“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚'; return; }
  const file = ex.files[type];
  if (!file) { pre.textContent = `${type} ã¯ç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`; return; }

  const path = ex.base + file;
  title.textContent = `${ex.label} â€“ ${type}`;
  meta.textContent = path.replace('./','/');

  // å®Ÿãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼ï¼ˆæ—¥æœ¬èªãƒ‘ã‚¹ + ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ï¼‰
  const url = encodeURI(path) + '?v=' + Date.now();
  const txt = await fetch(url, { cache: 'no-cache' }).then(r => r.text());
  pre.textContent = txt;

  // è¡¨ç¤ºãƒãƒªã‚·ãƒ¼ï¼š
  // - å¢¨å­—ï¼ç‚¹å­—ï¼šæ”¹è¡Œã®ã¿ã§æŠ˜ã‚Šè¿”ã—ï¼ˆwhite-space: preï¼‰
  //   â†’ 40æ–‡å­—è¡Œã‚’å´©ã•ãªã„ã€‚æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯å¿…è¦ã«å¿œã˜ã¦ã€‚
  // - å‚™è€ƒï¼šé€šå¸¸ã®æŠ˜ã‚Šè¿”ã—ï¼ˆwhite-space: pre-wrapï¼‰
  if (type === 'å‚™è€ƒ') {
    pre.style.whiteSpace = 'pre-wrap';
    pre.style.fontFamily = ''; // æ—¢å®šã®æœ¬æ–‡ãƒ•ã‚©ãƒ³ãƒˆ
    pre.style.lineHeight = '2.0';
  } else {
    pre.style.whiteSpace = 'pre'; // æ”¹è¡Œã®ã¿æœ‰åŠ¹ã€é€”ä¸­æŠ˜è¿”ã—ç¦æ­¢
    // ç­‰å¹…ãƒ•ã‚©ãƒ³ãƒˆã§40æ–‡å­—ã®â€œè¦‹ãŸç›®â€ã®å®‰å®šæ€§ã‚’ç¢ºä¿ï¼ˆå¢¨å­—ï¼‰
    // ç‚¹å­—ã¯ Apple Braille ç­‰ã‚’å„ªå…ˆã—ã¤ã¤ã€ç„¡ã‘ã‚Œã°ç­‰å¹…ç³»ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    if (type === 'å¢¨å­—') {
      pre.style.fontFamily =
        'ui-monospace, SFMono-Regular, Menlo, Consolas, "Noto Sans Mono CJK JP", "Noto Sans Mono", monospace';
    } else {
      pre.style.fontFamily =
        '"Apple Braille","Noto Sans Symbols2","Segoe UI Symbol", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace';
      // ç‚¹å­—ã®è¦–èªæ€§ã‚’å°‘ã—è£œå¼·ï¼ˆãŠå¥½ã¿ã§èª¿æ•´å¯ï¼‰
      pre.style.letterSpacing = '0.02em';
      pre.style.wordSpacing   = '0.15em';
    }
    pre.style.lineHeight = '2.0';
  }

  // æ–‡å­—ã‚µã‚¤ã‚ºã‚¹ãƒ©ã‚¤ãƒ€ï¼ˆâ€»æŠ˜è¿”ã—ã¯ä¸Šã® white-space è¨­å®šã§å›ºå®šï¼‰
  const size = document.getElementById('size');
  function applySize() {
    pre.style.fontSize = size.value + 'px';
  }
  size.addEventListener('input', applySize);
  applySize();
}
load();
</script>
</body>
</html>
